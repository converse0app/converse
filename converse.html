<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converse - Real Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Helvetica, Arial, sans-serif;
        }

        :root {
            --primary-color: #00a884;
            --dark-primary: #008f70;
            --dark-bg: #111b21;
            --dark-secondary: #202c33;
            --dark-tertiary: #2a3942;
            --dark-text: #e9edef;
            --light-bg: #ffffff;
            --light-secondary: #f0f2f5;
            --light-tertiary: #e9edef;
            --light-text: #111b21;
            --message-sent: #d9fdd3;
            --message-received: #ffffff;
            --online-indicator: #53bdeb;
            --error-color: #ff3b30;
            --success-color: #34c759;
        }

        body {
            background: var(--light-secondary);
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s;
        }

        body.dark-theme {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        /* Sidebar Styles */
        .sidebar {
            width: 30%;
            min-width: 300px;
            background: var(--light-bg);
            border-right: 1px solid var(--light-tertiary);
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }

        .dark-theme .sidebar {
            background: var(--dark-secondary);
            border-right: 1px solid var(--dark-tertiary);
        }

        .sidebar-header {
            padding: 16px;
            background: var(--light-tertiary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dark-theme .sidebar-header {
            background: var(--dark-secondary);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            position: relative;
        }

        .avatar.online::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--online-indicator);
            border-radius: 50%;
            border: 2px solid white;
            bottom: 0;
            right: 0;
        }

        .user-info h3 {
            font-size: 16px;
            font-weight: 500;
        }

        .user-info p {
            font-size: 12px;
            color: #667781;
        }

        .dark-theme .user-info p {
            color: #aebac1;
        }

        .header-icons {
            display: flex;
            gap: 20px;
            color: #54656f;
        }

        .dark-theme .header-icons {
            color: #aebac1;
        }

        .header-icons i {
            font-size: 20px;
            cursor: pointer;
        }

        .search-container {
            padding: 8px 16px;
            background: var(--light-bg);
        }

        .dark-theme .search-container {
            background: var(--dark-secondary);
        }

        .search-box {
            background: var(--light-secondary);
            padding: 10px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-theme .search-box {
            background: var(--dark-tertiary);
        }

        .search-box i {
            color: #54656f;
        }

        .dark-theme .search-box i {
            color: #aebac1;
        }

        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            font-size: 14px;
        }

        .dark-theme .search-box input {
            color: var(--dark-text);
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
        }

        .chat-item {
            display: flex;
            padding: 16px;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--light-tertiary);
            transition: background 0.2s;
        }

        .dark-theme .chat-item {
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .chat-item:hover {
            background: var(--light-secondary);
        }

        .dark-theme .chat-item:hover {
            background: var(--dark-tertiary);
        }

        .chat-item.active {
            background: var(--light-tertiary);
        }

        .dark-theme .chat-item.active {
            background: var(--dark-tertiary);
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            position: relative;
        }

        .chat-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 4px;
        }

        .chat-info h3 {
            font-size: 16px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }

        .chat-info p {
            font-size: 14px;
            color: #667781;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dark-theme .chat-info p {
            color: #aebac1;
        }

        .chat-time {
            font-size: 12px;
            color: #667781;
        }

        .dark-theme .chat-time {
            color: #aebac1;
        }

        /* Main Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--light-bg);
            position: relative;
        }

        .dark-theme .chat-area {
            background: var(--dark-bg);
        }

        .chat-header {
            padding: 16px;
            background: var(--light-tertiary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--light-tertiary);
        }

        .dark-theme .chat-header {
            background: var(--dark-secondary);
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .chat-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-user-info h3 {
            font-size: 16px;
            font-weight: 500;
        }

        .chat-user-info p {
            font-size: 12px;
            color: #667781;
        }

        .dark-theme .chat-user-info p {
            color: #aebac1;
        }

        .chat-options {
            display: flex;
            gap: 20px;
            color: #54656f;
        }

        .dark-theme .chat-options {
            color: #aebac1;
        }

        .chat-options i {
            font-size: 20px;
            cursor: pointer;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23f0f2f5' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .dark-theme .messages-container {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23202c33' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .message {
            max-width: 65%;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            background: var(--message-sent);
            align-self: flex-end;
            margin-left: auto;
        }

        .message.received {
            background: var(--message-received);
            align-self: flex-start;
        }

        .dark-theme .message.received {
            background: var(--dark-tertiary);
            color: var(--dark-text);
        }

        .message-time {
            font-size: 11px;
            color: #667781;
            text-align: right;
            margin-top: 4px;
        }

        .dark-theme .message-time {
            color: #aebac1;
        }

        .message-input-container {
            padding: 16px;
            background: var(--light-tertiary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark-theme .message-input-container {
            background: var(--dark-secondary);
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 20px;
            border: none;
            outline: none;
            font-size: 14px;
            background: var(--light-bg);
        }

        .dark-theme .message-input {
            background: var(--dark-tertiary);
            color: var(--dark-text);
        }

        .input-icons {
            display: flex;
            gap: 16px;
            color: #54656f;
        }

        .dark-theme .input-icons {
            color: #aebac1;
        }

        .input-icons i {
            font-size: 24px;
            cursor: pointer;
        }

        .send-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .send-button:hover {
            background: var(--dark-primary);
        }

        /* Settings Panel */
        .settings-panel {
            position: absolute;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--light-bg);
            border-left: 1px solid var(--light-tertiary);
            transition: right 0.3s ease;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        .dark-theme .settings-panel {
            background: var(--dark-secondary);
            border-left: 1px solid var(--dark-tertiary);
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            padding: 16px;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .settings-header i {
            font-size: 20px;
            cursor: pointer;
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--light-tertiary);
        }

        .dark-theme .settings-option {
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .logout-btn {
            background: #ff3b30;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 20px;
            width: 100%;
            text-align: center;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        /* Invite User Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--light-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .dark-theme .modal-content {
            background: var(--dark-secondary);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 18px;
            color: var(--primary-color);
        }

        .modal-header i {
            font-size: 20px;
            cursor: pointer;
            color: #54656f;
        }

        .dark-theme .modal-header i {
            color: #aebac1;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .modal-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .modal-btn.primary:hover {
            background: var(--dark-primary);
        }

        .modal-btn.secondary {
            background: var(--light-tertiary);
            color: var(--light-text);
        }

        .dark-theme .modal-btn.secondary {
            background: var(--dark-tertiary);
            color: var(--dark-text);
        }

        /* Search Results */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--light-bg);
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 5;
            display: none;
        }

        .dark-theme .search-results {
            background: var(--dark-secondary);
        }

        .search-result-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--light-tertiary);
        }

        .dark-theme .search-result-item {
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .search-result-item:hover {
            background: var(--light-secondary);
        }

        .dark-theme .search-result-item:hover {
            background: var(--dark-tertiary);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
        }

        .search-result-info h4 {
            font-size: 14px;
            font-weight: 500;
        }

        .search-result-info p {
            font-size: 12px;
            color: #667781;
        }

        .dark-theme .search-result-info p {
            color: #aebac1;
        }

        .add-friend-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            margin-left: auto;
        }

        .add-friend-btn:hover {
            background: var(--dark-primary);
        }

        .add-friend-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Friend Requests */
        .friend-requests-panel {
            position: absolute;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--light-bg);
            border-left: 1px solid var(--light-tertiary);
            transition: right 0.3s ease;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        .dark-theme .friend-requests-panel {
            background: var(--dark-secondary);
            border-left: 1px solid var(--dark-tertiary);
        }

        .friend-requests-panel.active {
            right: 0;
        }

        .friend-requests-header {
            padding: 16px;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .friend-requests-header i {
            font-size: 20px;
            cursor: pointer;
        }

        .friend-requests-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .friend-request-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--light-tertiary);
        }

        .dark-theme .friend-request-item {
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .friend-request-item:last-child {
            border-bottom: none;
        }

        .friend-request-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
        }

        .friend-request-info {
            flex: 1;
        }

        .friend-request-info h4 {
            font-size: 14px;
            font-weight: 500;
        }

        .friend-request-info p {
            font-size: 12px;
            color: #667781;
        }

        .dark-theme .friend-request-info p {
            color: #aebac1;
        }

        .friend-request-actions {
            display: flex;
            gap: 8px;
        }

        .accept-btn {
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .decline-btn {
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
        }

        /* Status Indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .status-online {
            background: var(--online-indicator);
        }

        .status-offline {
            background: #ccc;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                width: 100%;
                display: none;
            }
            
            .sidebar.active {
                display: flex;
            }
            
            .chat-area {
                width: 100%;
                display: none;
            }
            
            .chat-area.active {
                display: flex;
            }
            
            .back-button {
                display: block;
            }
        }

        .back-button {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .error-message {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }

        .success-message {
            color: var(--success-color);
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar active" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar online" id="userAvatar" onclick="toggleSettings()">U</div>
                    <div class="user-info">
                        <h3 id="userName">User Name</h3>
                        <p>Online</p>
                    </div>
                </div>
                <div class="header-icons">
                    <i class="fas fa-user-plus" onclick="toggleFriendRequests()"></i>
                    <i class="fas fa-ellipsis-v" onclick="toggleSettings()"></i>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search users by username" oninput="searchUsers()">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <div class="chat-list" id="chatList">
                <!-- Chat items will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="chat-header">
                <button class="back-button" onclick="toggleChatView()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="chat-user">
                    <div class="avatar online" id="chatAvatar">F</div>
                    <div class="chat-user-info">
                        <h3 id="chatUserName">Friend Name</h3>
                        <p id="chatUserStatus">Online</p>
                    </div>
                </div>
                <div class="chat-options">
                    <i class="fas fa-video"></i>
                    <i class="fas fa-phone"></i>
                    <i class="fas fa-ellipsis-v"></i>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be populated by JavaScript -->
            </div>
            
            <div class="message-input-container">
                <div class="input-icons">
                    <i class="far fa-smile"></i>
                    <i class="fas fa-paperclip"></i>
                </div>
                <input type="text" class="message-input" id="messageInput" placeholder="Type a message">
                <button class="send-button" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <i class="fas fa-arrow-left" onclick="toggleSettings()"></i>
                <h3>Settings</h3>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3>Account</h3>
                    <div class="settings-option">
                        <span>Username</span>
                        <span id="settingsUsername">username123</span>
                    </div>
                    <div class="settings-option">
                        <span>Email</span>
                        <span id="settingsEmail">user@example.com</span>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Preferences</h3>
                    <div class="settings-option">
                        <span>Dark Theme</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkThemeToggle" onchange="toggleDarkTheme()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-option">
                        <span>Notifications</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notificationsToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Privacy</h3>
                    <div class="settings-option">
                        <span>Last Seen</span>
                        <span>Everyone</span>
                    </div>
                    <div class="settings-option">
                        <span>Profile Photo</span>
                        <span>Everyone</span>
                    </div>
                </div>
                
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Friend Requests Panel -->
        <div class="friend-requests-panel" id="friendRequestsPanel">
            <div class="friend-requests-header">
                <i class="fas fa-arrow-left" onclick="toggleFriendRequests()"></i>
                <h3>Friend Requests</h3>
            </div>
            <div class="friend-requests-content" id="friendRequestsContent">
                <!-- Friend requests will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Invite User Modal -->
    <div class="modal" id="inviteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Start a Chat</h3>
                <i class="fas fa-times" onclick="closeInviteModal()"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="inviteUsername">Username</label>
                    <input type="text" id="inviteUsername" placeholder="Enter username to start chat">
                </div>
                <div id="inviteMessage" class="error-message"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeInviteModal()">Cancel</button>
                <button class="modal-btn primary" onclick="startChat()">Start Chat</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA9wDKfj_u0HvH_eNHJl-mSvRxMpz7S4BA",
            authDomain: "chatapp-85150.firebaseapp.com",
            projectId: "chatapp-85150",
            storageBucket: "chatapp-85150.firebasestorage.app",
            messagingSenderId: "336086592013",
            appId: "1:336086592013:web:7537e44138b9cf682f0344",
            measurementId: "G-PBZMEMDETT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const chatArea = document.getElementById('chatArea');
        const settingsPanel = document.getElementById('settingsPanel');
        const friendRequestsPanel = document.getElementById('friendRequestsPanel');
        const inviteModal = document.getElementById('inviteModal');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const chatList = document.getElementById('chatList');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const chatAvatar = document.getElementById('chatAvatar');
        const chatUserName = document.getElementById('chatUserName');
        const chatUserStatus = document.getElementById('chatUserStatus');
        const settingsUsername = document.getElementById('settingsUsername');
        const settingsEmail = document.getElementById('settingsEmail');
        const darkThemeToggle = document.getElementById('darkThemeToggle');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const friendRequestsContent = document.getElementById('friendRequestsContent');

        // Current user and chat data
        let currentUser = null;
        let currentChat = null;
        let chats = [];
        let users = [];
        let friendRequests = [];
        let friends = [];
        let searchTimeout = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            setupEventListeners();
        });

        // Check if user is authenticated
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    window.location.href = 'index.html';
                }
            });
        }

        // Load user data from Firestore
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Update UI with user data
                    const firstLetter = userData.firstName ? userData.firstName.charAt(0).toUpperCase() : 'U';
                    userAvatar.textContent = firstLetter;
                    chatAvatar.textContent = firstLetter;
                    userName.textContent = `${userData.firstName} ${userData.lastName}`;
                    settingsUsername.textContent = userData.username;
                    settingsEmail.textContent = userData.email;
                    
                    // Update user online status
                    await db.collection('users').doc(currentUser.uid).update({
                        isOnline: true,
                        lastSeen: new Date()
                    });
                    
                    // Load user data
                    loadFriends();
                    loadFriendRequests();
                    loadUserChats();
                    
                    // Set up real-time listeners
                    setupRealtimeListeners();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Load user's friends
        async function loadFriends() {
            try {
                const friendsSnapshot = await db.collection('friendships')
                    .where('users', 'array-contains', currentUser.uid)
                    .where('status', '==', 'accepted')
                    .get();
                
                friends = [];
                friendsSnapshot.forEach(doc => {
                    const friendship = doc.data();
                    const friendId = friendship.users.find(id => id !== currentUser.uid);
                    friends.push(friendId);
                });
                
                // Load friend details
                if (friends.length > 0) {
                    const friendsSnapshot = await db.collection('users')
                        .where('uid', 'in', friends)
                        .get();
                    
                    users = [];
                    friendsSnapshot.forEach(doc => {
                        users.push(doc.data());
                    });
                }
            } catch (error) {
                console.error('Error loading friends:', error);
            }
        }

        // Load friend requests
        async function loadFriendRequests() {
            try {
                const requestsSnapshot = await db.collection('friendRequests')
                    .where('toUser', '==', currentUser.uid)
                    .where('status', '==', 'pending')
                    .get();
                
                friendRequests = [];
                requestsSnapshot.forEach(doc => {
                    friendRequests.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderFriendRequests();
            } catch (error) {
                console.error('Error loading friend requests:', error);
            }
        }

        // Load user chats from Firestore
        async function loadUserChats() {
            try {
                const chatsSnapshot = await db.collection('chats')
                    .where('participants', 'array-contains', currentUser.uid)
                    .orderBy('lastMessageTime', 'desc')
                    .get();
                
                chats = [];
                for (const doc of chatsSnapshot.docs) {
                    const chatData = doc.data();
                    const otherUserId = chatData.participants.find(id => id !== currentUser.uid);
                    
                    // Get user details
                    const userDoc = await db.collection('users').doc(otherUserId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Get messages for this chat
                        const messagesSnapshot = await db.collection('chats')
                            .doc(doc.id)
                            .collection('messages')
                            .orderBy('timestamp', 'asc')
                            .get();
                        
                        const messages = [];
                        messagesSnapshot.forEach(msgDoc => {
                            messages.push({
                                id: msgDoc.id,
                                ...msgDoc.data()
                            });
                        });
                        
                        chats.push({
                            id: doc.id,
                            name: `${userData.firstName} ${userData.lastName}`,
                            userId: otherUserId,
                            lastMessage: chatData.lastMessage || 'No messages yet',
                            lastMessageTime: chatData.lastMessageTime?.toDate() || new Date(),
                            unread: 0,
                            messages: messages
                        });
                    }
                }
                
                renderChatList();
                
                // Select first chat by default
                if (chats.length > 0) {
                    selectChat(chats[0].id);
                }
            } catch (error) {
                console.error('Error loading chats:', error);
            }
        }

        // Set up real-time listeners
        function setupRealtimeListeners() {
            // Listen for new messages in current chat
            if (currentChat) {
                db.collection('chats')
                    .doc(currentChat.id)
                    .collection('messages')
                    .orderBy('timestamp', 'asc')
                    .onSnapshot(snapshot => {
                        snapshot.docChanges().forEach(change => {
                            if (change.type === 'added') {
                                const message = {
                                    id: change.doc.id,
                                    ...change.doc.data()
                                };
                                
                                // Add message to current chat
                                if (!currentChat.messages.find(m => m.id === message.id)) {
                                    currentChat.messages.push(message);
                                    displayMessages(currentChat.messages);
                                    scrollToBottom();
                                }
                            }
                        });
                    });
            }
            
            // Listen for new friend requests
            db.collection('friendRequests')
                .where('toUser', '==', currentUser.uid)
                .where('status', '==', 'pending')
                .onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'added') {
                            const request = {
                                id: change.doc.id,
                                ...change.doc.data()
                            };
                            
                            if (!friendRequests.find(r => r.id === request.id)) {
                                friendRequests.push(request);
                                renderFriendRequests();
                            }
                        } else if (change.type === 'removed') {
                            friendRequests = friendRequests.filter(r => r.id !== change.doc.id);
                            renderFriendRequests();
                        }
                    });
                });
        }

        // Search users by username
        async function searchUsers() {
            clearTimeout(searchTimeout);
            const query = searchInput.value.trim();
            
            if (query.length < 2) {
                searchResults.style.display = 'none';
                return;
            }
            
            searchTimeout = setTimeout(async () => {
                try {
                    const usersSnapshot = await db.collection('users')
                        .where('username', '>=', query)
                        .where('username', '<=', query + '\uf8ff')
                        .limit(10)
                        .get();
                    
                    searchResults.innerHTML = '';
                    
                    if (usersSnapshot.empty) {
                        searchResults.innerHTML = '<div class="search-result-item">No users found</div>';
                    } else {
                        usersSnapshot.forEach(doc => {
                            const userData = doc.data();
                            if (userData.uid !== currentUser.uid) {
                                const isFriend = friends.includes(userData.uid);
                                const hasPendingRequest = friendRequests.some(req => 
                                    req.fromUser === userData.uid || req.toUser === userData.uid
                                );
                                
                                const resultItem = document.createElement('div');
                                resultItem.className = 'search-result-item';
                                resultItem.innerHTML = `
                                    <div class="search-result-avatar">${userData.firstName.charAt(0).toUpperCase()}</div>
                                    <div class="search-result-info">
                                        <h4>${userData.firstName} ${userData.lastName}</h4>
                                        <p>@${userData.username}</p>
                                    </div>
                                    ${!isFriend && !hasPendingRequest ? 
                                        `<button class="add-friend-btn" onclick="sendFriendRequest('${userData.uid}')">Add Friend</button>` :
                                        `<button class="add-friend-btn" disabled>${isFriend ? 'Friends' : 'Request Sent'}</button>`
                                    }
                                `;
                                searchResults.appendChild(resultItem);
                            }
                        });
                    }
                    
                    searchResults.style.display = 'block';
                } catch (error) {
                    console.error('Error searching users:', error);
                }
            }, 300);
        }

        // Send friend request
        async function sendFriendRequest(toUserId) {
            try {
                // Check if request already exists
                const existingRequest = await db.collection('friendRequests')
                    .where('fromUser', '==', currentUser.uid)
                    .where('toUser', '==', toUserId)
                    .where('status', '==', 'pending')
                    .get();
                
                if (!existingRequest.empty) {
                    alert('Friend request already sent');
                    return;
                }
                
                // Create friend request
                await db.collection('friendRequests').add({
                    fromUser: currentUser.uid,
                    toUser: toUserId,
                    status: 'pending',
                    timestamp: new Date()
                });
                
                alert('Friend request sent!');
                searchResults.style.display = 'none';
                searchInput.value = '';
            } catch (error) {
                console.error('Error sending friend request:', error);
                alert('Error sending friend request');
            }
        }

        // Accept friend request
        async function acceptFriendRequest(requestId) {
            try {
                const requestDoc = await db.collection('friendRequests').doc(requestId).get();
                if (!requestDoc.exists) return;
                
                const request = requestDoc.data();
                
                // Update request status
                await db.collection('friendRequests').doc(requestId).update({
                    status: 'accepted'
                });
                
                // Create friendship
                await db.collection('friendships').add({
                    users: [currentUser.uid, request.fromUser],
                    status: 'accepted',
                    createdAt: new Date()
                });
                
                // Update local data
                friendRequests = friendRequests.filter(req => req.id !== requestId);
                friends.push(request.fromUser);
                
                renderFriendRequests();
                
                // Reload chats to include new friend
                loadUserChats();
            } catch (error) {
                console.error('Error accepting friend request:', error);
            }
        }

        // Decline friend request
        async function declineFriendRequest(requestId) {
            try {
                await db.collection('friendRequests').doc(requestId).update({
                    status: 'declined'
                });
                
                // Update local data
                friendRequests = friendRequests.filter(req => req.id !== requestId);
                renderFriendRequests();
            } catch (error) {
                console.error('Error declining friend request:', error);
            }
        }

        // Render friend requests
        async function renderFriendRequests() {
            friendRequestsContent.innerHTML = '';
            
            if (friendRequests.length === 0) {
                friendRequestsContent.innerHTML = '<p>No pending friend requests</p>';
                return;
            }
            
            for (const request of friendRequests) {
                const fromUserDoc = await db.collection('users').doc(request.fromUser).get();
                if (!fromUserDoc.exists) continue;
                
                const fromUser = fromUserDoc.data();
                
                const requestItem = document.createElement('div');
                requestItem.className = 'friend-request-item';
                requestItem.innerHTML = `
                    <div class="friend-request-avatar">${fromUser.firstName.charAt(0).toUpperCase()}</div>
                    <div class="friend-request-info">
                        <h4>${fromUser.firstName} ${fromUser.lastName}</h4>
                        <p>@${fromUser.username}</p>
                    </div>
                    <div class="friend-request-actions">
                        <button class="accept-btn" onclick="acceptFriendRequest('${request.id}')">Accept</button>
                        <button class="decline-btn" onclick="declineFriendRequest('${request.id}')">Decline</button>
                    </div>
                `;
                friendRequestsContent.appendChild(requestItem);
            }
        }

        // Start a new chat
        async function startChat() {
            const username = document.getElementById('inviteUsername').value.trim();
            const messageDiv = document.getElementById('inviteMessage');
            
            if (!username) {
                messageDiv.textContent = 'Please enter a username';
                return;
            }
            
            try {
                // Find user by username
                const userSnapshot = await db.collection('users')
                    .where('username', '==', username.toLowerCase())
                    .get();
                
                if (userSnapshot.empty) {
                    messageDiv.textContent = 'User not found';
                    return;
                }
                
                const userDoc = userSnapshot.docs[0];
                const userData = userDoc.data();
                
                // Check if user is a friend
                if (!friends.includes(userData.uid)) {
                    messageDiv.textContent = 'You can only chat with friends';
                    return;
                }
                
                // Check if chat already exists
                const existingChat = await db.collection('chats')
                    .where('participants', 'array-contains', currentUser.uid)
                    .get();
                
                let chatId = null;
                existingChat.forEach(doc => {
                    const chatData = doc.data();
                    if (chatData.participants.includes(userData.uid)) {
                        chatId = doc.id;
                    }
                });
                
                if (chatId) {
                    // Chat exists, select it
                    selectChat(chatId);
                } else {
                    // Create new chat
                    const chatRef = await db.collection('chats').add({
                        participants: [currentUser.uid, userData.uid],
                        lastMessage: '',
                        lastMessageTime: new Date(),
                        createdAt: new Date()
                    });
                    
                    // Add to local chats
                    const newChat = {
                        id: chatRef.id,
                        name: `${userData.firstName} ${userData.lastName}`,
                        userId: userData.uid,
                        lastMessage: 'No messages yet',
                        lastMessageTime: new Date(),
                        unread: 0,
                        messages: []
                    };
                    
                    chats.unshift(newChat);
                    renderChatList();
                    selectChat(chatRef.id);
                }
                
                closeInviteModal();
            } catch (error) {
                console.error('Error starting chat:', error);
                messageDiv.textContent = 'Error starting chat';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Enter key to send message
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Click outside search results to close them
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });

            // Check for dark theme preference
            if (localStorage.getItem('darkTheme') === 'true') {
                document.body.classList.add('dark-theme');
                darkThemeToggle.checked = true;
            }
        }

        // Toggle between mobile views
        function toggleChatView() {
            if (window.innerWidth <= 900) {
                sidebar.classList.toggle('active');
                chatArea.classList.toggle('active');
            }
        }

        // Toggle settings panel
        function toggleSettings() {
            settingsPanel.classList.toggle('active');
        }

        // Toggle friend requests panel
        function toggleFriendRequests() {
            friendRequestsPanel.classList.toggle('active');
        }

        // Toggle dark theme
        function toggleDarkTheme() {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
        }

        // Show invite modal
        function showInviteModal() {
            inviteModal.classList.add('active');
        }

        // Close invite modal
        function closeInviteModal() {
            inviteModal.classList.remove('active');
            document.getElementById('inviteUsername').value = '';
            document.getElementById('inviteMessage').textContent = '';
        }

        // Send message
        async function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText && currentChat) {
                try {
                    // Add message to Firestore
                    await db.collection('chats').doc(currentChat.id).collection('messages').add({
                        text: messageText,
                        sender: currentUser.uid,
                        timestamp: new Date(),
                        read: false
                    });
                    
                    // Update last message in chat
                    await db.collection('chats').doc(currentChat.id).update({
                        lastMessage: messageText,
                        lastMessageTime: new Date()
                    });
                    
                    messageInput.value = '';
                } catch (error) {
                    console.error('Error sending message:', error);
                }
            }
        }

        // Display messages in chat area
        function displayMessages(messages) {
            messagesContainer.innerHTML = '';
            
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.sender === currentUser.uid ? 'sent' : 'received'}`;
                
                const timeString = message.timestamp.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageElement.innerHTML = `
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${timeString}</div>
                `;
                
                messagesContainer.appendChild(messageElement);
            });
        }

        // Scroll to bottom of messages
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Select chat to view
        function selectChat(chatId) {
            currentChat = chats.find(chat => chat.id === chatId);
            if (currentChat) {
                chatUserName.textContent = currentChat.name;
                chatAvatar.textContent = currentChat.name.charAt(0).toUpperCase();
                chatUserStatus.textContent = 'Online';
                displayMessages(currentChat.messages);
                scrollToBottom();
                
                // Mark as read
                currentChat.unread = 0;
                renderChatList();
                
                // Set up real-time listener for this chat
                setupRealtimeListeners();
                
                // Switch to chat view on mobile
                if (window.innerWidth <= 900) {
                    toggleChatView();
                }
            }
        }

        // Render chat list
        function renderChatList() {
            chatList.innerHTML = '';
            
            if (chats.length === 0) {
                chatList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #667781;">
                        <p>No chats yet</p>
                        <button class="add-friend-btn" onclick="showInviteModal()" style="margin-top: 10px;">Start a Chat</button>
                    </div>
                `;
                return;
            }
            
            chats.forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = `chat-item ${currentChat && currentChat.id === chat.id ? 'active' : ''}`;
                chatElement.onclick = () => selectChat(chat.id);
                
                const timeString = chat.lastMessageTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                chatElement.innerHTML = `
                    <div class="chat-avatar">${chat.name.charAt(0).toUpperCase()}</div>
                    <div class="chat-info">
                        <h3>
                            ${chat.name}
                            <span class="chat-time">${timeString}</span>
                        </h3>
                        <p>${chat.lastMessage}</p>
                    </div>
                `;
                
                chatList.appendChild(chatElement);
            });
        }

        // Logout function
        function logout() {
            // Update user offline status
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).update({
                    isOnline: false,
                    lastSeen: new Date()
                });
            }
            
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            });
        }
    </script>
</body>
</html>
